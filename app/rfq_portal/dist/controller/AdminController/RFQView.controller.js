sap.ui.define(["rfqportal/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/ui/core/Fragment","sap/ui/core/format/DateFormat"],(t,e,o,i,a)=>{"use strict";return t.extend("rfqportal.controller.RFQView",{onInit(){this._oDateFormat=a.getDateInstance({style:"short"});var t=new sap.ui.model.json.JSONModel({ID:[],title:[],status:[]});this.getView().setModel(t,"filters")},onRefresh:function(){const t=this.byId("rfqTable");if(t){const e=t.getBinding("rows");if(e){e.refresh();o.show("Table refreshed")}else{o.show("No binding found")}}},formatDate:function(t){if(!t){return""}const e=new Date(t);if(isNaN(e.getTime())){return t}return e.toLocaleDateString("en-GB")},onViewDetail:function(t){const e=t.getSource().getBindingContext();if(!e){o.show("No data selected");return}this._showDetailDialogWithContext(e)},_showDetailDialogWithContext:function(t){const e=this.getView();if(!this._oDetailDialog){i.load({id:e.getId(),name:"rfqportal.fragment.detailPopup",controller:this}).then(o=>{this._oDetailDialog=o;e.addDependent(this._oDetailDialog);if(o.oPopup&&typeof o.oPopup.setModal==="function"){o.oPopup.setModal(false)}this._oDetailDialog.setBindingContext(t);this._oDetailDialog.open()}).catch(()=>{o.show("Error loading detail dialog")})}else{this._oDetailDialog.setBindingContext(t);this._oDetailDialog.open()}},_showDetailDialog:function(t){const e=this.getView();if(!this._oDetailDialog){i.load({id:e.getId(),name:"rfqportal.fragment.detailPopup",controller:this}).then(o=>{this._oDetailDialog=o;e.addDependent(this._oDetailDialog);this._bindDialogToContext(t)}).catch(()=>{o.show("Error loading detail dialog")})}else{this._bindDialogToContext(t)}},_bindDialogToContext:function(t){try{const i=this.getView().getModel();if(i&&i.getMetadata().getName()==="sap.ui.model.odata.v4.ODataModel"){const a=`/RFQs(${t})`;const l={};const n=i.bindContext(a,null,l);n.requestObject().then(t=>{if(t){const o=new e(t);this._oDetailDialog.setModel(o);this._oDetailDialog.open()}else{o.show("No data found for this RFQ")}}).catch(()=>{const e=this.getView().byId("rfqTable").getBinding("rows").getCurrentContexts().find(e=>e.getProperty("ID")===t);if(e){this._oDetailDialog.setBindingContext(e);this._oDetailDialog.open()}else{o.show("Error loading RFQ data")}})}else{o.show("Unsupported model type")}}catch(t){o.show("Error loading detailed data: "+t.message)}},onCloseDialog:function(){if(this._oDetailDialog){this._oDetailDialog.close()}},onDownloadRFQ:function(){o.show("Download functionality to be implemented")},onFilterSearch:function(t){var e=this.getView().getModel("filters").getData();var o=[];if(e.ID&&e.ID.length>0){e.ID.forEach(function(t){if(t.values&&t.values[0]){o.push(new sap.ui.model.Filter("ID",sap.ui.model.FilterOperator.EQ,t.values[0]))}})}if(e.title&&e.title.length>0){e.title.forEach(function(t){if(t.values&&t.values[0]){o.push(new sap.ui.model.Filter("title",sap.ui.model.FilterOperator.Contains,t.values[0]))}})}if(e.status&&e.status.length>0){e.status.forEach(function(t){if(t.values&&t.values[0]){o.push(new sap.ui.model.Filter("status",sap.ui.model.FilterOperator.EQ,t.values[0]))}})}var i=this.byId("rfqTable");if(i){var a=i.getBinding("rows");if(a){a.filter(o)}}}})});
//# sourceMappingURL=RFQView.controller.js.map