sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/routing/History","sap/ui/core/UIComponent","sap/m/MessageBox"],function(e,t,o,r){"use strict";return e.extend("rfqportal.controller.Guest",{onInit:function(){var e=new sap.ui.model.json.JSONModel({roles:[{key:"ADMIN",text:"Administrator"},{key:"VENDOR",text:"Vendor"},{key:"BUYER",text:"Buyer"}],username:"",password:"",selectedRole:"",currentUser:null,availableRoles:[],isLoggedIn:false});this.getView().setModel(e);this._checkExistingSession()},_checkExistingSession:function(){var e=sessionStorage.getItem("userSession");if(e){var t=JSON.parse(e);var o=this.getView().getModel();o.setProperty("/currentUser",t);o.setProperty("/isLoggedIn",true);this._setAvailableRoles(t.username)}},_setAvailableRoles:function(e){var t=[];var o=this.getView().getModel();if(e==="admin"){t=[{key:"ADMIN",text:"Administrator"},{key:"BUYER",text:"Buyer (as Admin)"},{key:"VENDOR",text:"Vendor (as Admin)"}]}else if(e==="vendor"){t=[{key:"VENDOR",text:"Vendor"}]}else{t=[{key:"BUYER",text:"Buyer"}]}o.setProperty("/availableRoles",t)},onLogin:function(){var e=this.getView().getModel();var t=e.getProperty("/username");var o=e.getProperty("/password");var s=e.getProperty("/selectedRole");if(!t||!o||!s){r.error("Please fill in all required fields.");return}this._authenticateUser(t,o,s)},_authenticateUser:function(e,t,o){var s=this;if(this._validateCredentials(e,t)){var i={username:e,role:o,originalRole:o,token:"mock-token-"+Date.now(),loginTime:(new Date).toISOString()};sessionStorage.setItem("userSession",JSON.stringify(i));var a=this.getView().getModel();a.setProperty("/currentUser",i);a.setProperty("/isLoggedIn",true);this._setAvailableRoles(e);this._navigateByRole(o);r.success("Login successful as "+o)}else{r.error("Invalid credentials")}},_validateCredentials:function(e,t){var o={admin:"admin",vendor:"vendor"};return o[e]===t},onSwitchRole:function(){var e=this;var t=this.getView().getModel();var o=t.getProperty("/currentUser");var s=t.getProperty("/availableRoles");if(!o||s.length<=1){r.information("No other roles available for switching.");return}this._createRoleSwitchDialog(s,o)},_createRoleSwitchDialog:function(e,t){var o=this;if(!this._roleSwitchDialog){this._roleSwitchDialog=new sap.m.Dialog({title:"Switch Role",contentWidth:"400px",content:[new sap.m.VBox({class:"sapUiMediumMargin",items:[new sap.m.Label({text:"Current Role: "+t.role,class:"sapUiMediumMarginBottom"}),new sap.m.Label({text:"Switch to:",class:"sapUiSmallMarginBottom"}),new sap.m.Select({id:"roleSwitchSelect",width:"100%",items:{path:"/availableRoles",template:new sap.ui.core.Item({key:"{key}",text:"{text}"})}})]})],beginButton:new sap.m.Button({text:"Switch",type:"Emphasized",press:function(){o._performRoleSwitch()}}),endButton:new sap.m.Button({text:"Cancel",press:function(){o._roleSwitchDialog.close()}})});this.getView().addDependent(this._roleSwitchDialog)}this._roleSwitchDialog.setModel(this.getView().getModel());this._roleSwitchDialog.open()},_performRoleSwitch:function(){var e=sap.ui.getCore().byId("roleSwitchSelect");var t=e.getSelectedKey();if(!t){r.error("Please select a role to switch to.");return}var o=this.getView().getModel();var s=o.getProperty("/currentUser");s.role=t;sessionStorage.setItem("userSession",JSON.stringify(s));o.setProperty("/currentUser",s);this._roleSwitchDialog.close();this._navigateByRole(t);r.success("Role switched to "+t)},_navigateByRole:function(e){switch(e){case"ADMIN":o.getRouterFor(this).navTo("RouteAppAdmin");break;case"VENDOR":o.getRouterFor(this).navTo("RouteVendor");break;case"BUYER":o.getRouterFor(this).navTo("RouteBuyer");break;default:r.error("Invalid role specified.")}},onLogout:function(){var e=this;r.confirm("Are you sure you want to logout?",{title:"Confirm Logout",onClose:function(t){if(t===r.Action.OK){e._performLogout()}}})},_performLogout:function(){sessionStorage.removeItem("userSession");var e=this.getView().getModel();e.setData({roles:[{key:"ADMIN",text:"Administrator"},{key:"VENDOR",text:"Vendor"},{key:"BUYER",text:"Buyer"}],username:"",password:"",selectedRole:"",currentUser:null,availableRoles:[],isLoggedIn:false});o.getRouterFor(this).navTo("RouteGuest");sap.m.MessageToast.show("You have been successfully logged out.")}})});
//# sourceMappingURL=Guest.controller.js.map